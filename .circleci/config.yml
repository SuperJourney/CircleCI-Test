version: 2.1
jobs:
  build:
    docker:
      - image: golang:1.16.5
    working_directory: /go/src/github.com/SuperJourney/CircleCI-Test
    steps:
      - checkout
      - run: go build
      - run: go test -v
  deploy:
    docker:
      - image: golang:1.16.5
    working_directory: /go/src/github.com/SuperJourney/CircleCI-Test
    steps:
      - checkout
      - run:
          name: Build binary
          command: GOOS=linux GOARCH=amd64 go build -o app
      - run:
          name: Deploy to production
          command: |
            echo "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" > key.pem
            chmod 400 key.pem
            cat key.pem
            ssh -o StrictHostKeyChecking=no -i key.pem ubuntu@182.254.176.160 "sudo -E docker compose -f /home/ubuntu/CircleCI-Test/docker-compose.yml up --build -d"
    environment:
      ip: 182.254.176.160
      pem: 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

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build:
          filters:
            branches:
              only: main
      - deploy:
          requires:
            - build
          filters:
            branches:
              only: main
          context: tyun